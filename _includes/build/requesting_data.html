<p>
	To obtain all the available data (up to 7 years) for all of your beneficiaries, you can make a request to either the /Patient or /Group endpoint. You may want to do this as a first call, as a way to check for BCDA files against CCLF, or to create a database.
</p>
<p>
	BCDA data will be updated weekly, so you will be able to make requests and expect to retrieve new data on a weekly basis.
</p>

<h2>List of Requests</h2>
<p>You can make a few different unfiltered requests for data:</p>
<ol>
	<li>Request all three Resource Types at once</li>
	<li>Request any two Resource Types</li>
	<li>Request a single Resource Type</li>
</ol>

<h3>Steps</h3>
<p>
	Each request will follow the same four step process:
</p>
<ol>
	<li>Obtain an access token</li>
	<li>Start a job to acquire data</li>
	<li>Check the job status</li>
	<li>Download the data</li>
</ol>








<h2>Request all three resource types</h2>

<div class="ds-c-alert ds-c-alert--hide-icon">
    	<div class="ds-c-alert__body">
    	  <h3 class="ds-c-alert__heading"> The examples below are for the /Patient endpoint.</h3>
    	    <p class="ds-c-alert__text">
    	      Note: We have provided a few examples below. But, we are retrieving resource types only from the /Patient endpoint for only certain resource types. The request and cURL statements can be altered to retrieve any combination of resource types and resource types from the /Group endpoint as needed.
    	  	</p>
    	</div>
	</div>





<h3>Step 1: Obtain an Access Token</h3>
	<p>
		See <a href="https://bcda.cms.gov/production/technical-user-guide/#authentication-and-authorization">Authentication and Authorization</a> above.
	</p>






<h3>Step 2: Start a job to acquire data</h3>

<h4>Requests to start a job</h4>
<code>
	<ol>
		<li>GET /api/v1/Patient/$export</li>
		<li>GET /api/v1/Patient/$export?_type=ExplanationOfBenefit,Patient</li>
		<li>GET /api/v1/Patient/$export?_type=Patient</li>
	</ol>
</code>

<h4>Request Headers</h4>
<code>
	<ul>
		<li>Authorization: Bearer {token}</li>
		<li>Accept: application/fhir+json</li>
		<li>Prefer: respond-async</li>
	</ul>
</code>

<h4>cURL Commands to start a job</h4>
	<code>
			<ol>	
				<li>curl -X GET "<a href="https://api.bcda.cms.gov/api/v1/Patient/$export">https://api.bcda.cms.gov/api/v1/Patient/$export</a>"<br/>-H "accept: application/fhir+json"<br/>-H 	"Prefer: respond-async"<br/>-H "Authorization: Bearer {token}"`</li>			
				<li>curl -X GET "<a href="https://api.bcda.cms.gov/api/v1/Patient/$export?_ty	pe=ExplanationOfBenefit,Patient">https://api.bcda.cms.gov/api/v1/Patient/$export?_type=ExplanationOf	Benefit,Patient	</a>"<br/>-H "accept: application/fhir+json"<br/>-H "Prefer: respond-async"<br/>-H "Authorization: Bearer {token}"`</li>		
				<li>curl -X GET "https://api.bcda.cms.gov/api/v1/Patient/$export?_type=Patient	"</li>	
			</ol>	
		<p>-H "accept: application/fhir+json"<br/>-H "Prefer: respond-async"<br/>-H "Authorization: Bearer {token}"`</p>
	</code>

<h4>Response Example: Successful Request</h4>
	<code>
		<p>202 Accepted</p>
	</code>

<h4>Response Example: Too Many Requests</h4>
	<code>
		<p>429 Too Many Requests</p>
	</code>

<h4>Response Headers</h4>
	<code>
		<p>Content-Location: https://api.bcda.cms.gov/api/v1/jobs/42</p>
	</code>

<h4>Start a Job Explanation</h4>
	<p>
		This operation will start a data export job. We have provided three example requests and three example cURL statements to start a job for A) all three resource types, B) any two resource types (we use EOB and Patient as an example), or C) any single resource type (we use Patient as an example). All of these can be modified to work with the /Group endpoint by replacing /Patient/ with /Group/all/.
	</p>	
	<p>
		For all three resource types, a GET request is made to the /Patient endpoint without the _type query parameter. For one or two resource types, the desired resources are set in the _type query parameter. Noti	ce that, for multiple resource types, they must be separated by commas.
	</p>	
	<p>
		Your access token is required and set as a header. Accept and Prefer headers are also r	equired. The dollar sign ('$') before the word "export" in the URL indicates that the endpoint is an action rather than a resource. The format is defined by the FHIR Bulk Data Export spec.
	</p>	
	<p>
		If the request was successful, a 202 Accepted response code will be returned and the re	sponse will include a Content-Location header. The value of this header indicates the location to check for job status and outcome. In the example header below, the number 42 in the URL represents the ID of the export job.
	</p>
	<p>
		If you're already requesting data from one endpoint and try to request data from that endpoint again while the first request is processing, you'll receive a 429 Too Many Requests error.
	</p>






<h3>Step 3: Check the job status</h3>

<h4>Request to check the job status</h4>
	<code>
		<p>
			GET https://api.bcda.cms.gov/api/v1/jobs/42
		</p>
	</code>

<h4>Request Headers</h4>
	<code>
		<ul>
			<li>accept: application/fhir+json</li>
			<li>Authorization: Bearer {token}</li>
		</ul>
	</code>

<h4>cURL Command to check the job status</h4>
	<code>
		<p>curl -X GET "https://api.bcda.cms.gov/api/v1/jobs/42" \</p>
		<p>-H "accept: application/fhir+json" \</p>
		<p>-H "Authorization: Bearer {token}"</p>
	</code>

<h4>Response Example: Completed Job</h4>
	<code>
		<p>{</p>
		<p>"transactionTime": "2019-12-09T20:44:01.705398Z",</p>
		<p>"request": "https://api.bcda.cms.gov/api/v1/Patient/$export",</p>
		<p>"requiresAccessToken": true,</p>
		<p>"output": [</p>
		<p>{</p>
		<p>"type": "ExplanationOfBenefit",</p>
		<p>"url": "https://api.bcda.cms.gov/data/42/afd22dfa-c239-4063-8882-eb2712f9f638.ndjson"</p>
		<p>},</p>
		<p>{</p>
		<p>"type": "Coverage",</p>
		<p>"url": "https://api.bcda.cms.gov/data/42/f76a0b76-48ed-4033-aad9-d3eec37e7e83.ndjson"</p>
		<p>},</p>
		<p>{</p>
		<p>"type": "Patient",</p>
		<p>"url": "https://api.bcda.cms.gov/data/42/f92dcf16-63a2-448e-a12a-3bf677f966ed.ndjson"</p>
		<p>}</p>
		<p>],</p>
		<p>"error": [],</p>
		<p>"JobID": 42</p>
		<p>}</p>
	</code>

<h4>Response Headers: Incomplete Job</h4>
	<ul>
		<li>X-Progress: In Progress</li>
	</ul>

<h4>Check the Job Status Explanation</h4>
	<p>This operation will check on the status of a job and return its progress if it has not finished. Notice that the GET request is simply the URL found in the Content-Location header. The Content 	Location header is found from the previous step (starting a job) within the response section.</p>	
	<p>Within the response, a 202 Accepted indicates that the job is processing. The response headers	 will include the X-Progress header. The X-Progress header value will include text indicating the 	job's status in BCDA's workflow and an estimated progress percentage. For example, X-Progress: In	 Progress, 80%.</p>	
	<p>The status will change from 202 Accepted to 200 OK when the export job is complete and the data is ready to be downloaded.</p>	
	<p>Claims data can be found at the URLs within the output field. The number 42 in the data file URLs is the same job ID from the Content-Location header URL in the previous step. If some of the 	data cannot be exported due to errors, details of the errors can be found at the URLs in the error field. The errors are provided in an NDJSON file as FHIR OperationOutcome resources.</p>






<h3>Step 4: Download the data</h3>

<h4>Request to download the data</h4>
	<code>
		<p>GET https://api.bcda.cms.gov/data/42/afd22dfa-c239-4063-8882-eb2712f9f638.ndjson</p>
	</code>

<h4>Request Headers</h4>
	<code>
		<ul>
			<li>Authorization: Bearer {token}</li>
			<li>Accept-Encoding: gzip</li>
		</ul>
	</code>

<h4>cURL Command to download the data</h4>
	<code>
		<p>curl https://api.bcda.cms.gov/data/42/afd22dfa-c239-4063-8882-eb2712f9f638.ndjson \</p>
		<p>-H 'Authorization: Bearer {token}'<br/>-H 'Accept-Encoding: gzip'</p>
	</code>

<h4>Response Example</h4>
	<p>
	<ol>
	    <li><b><a href="https://bcda.cms.gov/assets/data/ExplanationOfBenefit.ndjson" target="_blank"> Explanation of Benefit</a></b></li>
	    <li><b><a href="https://bcda.cms.gov/assets/data/Coverage.ndjson" target="_blank"> Patient</a></b></li>
	    <li><b><a href="https://bcda.cms.gov/assets/data/Patient.ndjson" target="_blank"> Coverage</a></b></li>
	  </ol>
	</p>

<h4>Response Headers</h4>
	<code>
		<p>N/A</p>
	</code>

<h4>Downloading the Data Explanation</h4>
	<p>
		This operation will allow you to obtain the exported data. Notice that the request contains the output URL for a job that is complete (200 OK status).
	</p>
	
	<div class="ds-c-alert ds-c-alert--hide-icon">
    	<div class="ds-c-alert__body">
    	  <h3 class="ds-c-alert__heading"> Files expire after 24 hours.</h3>
    	    <p class="ds-c-alert__text">
				Note:: You will need to download the data file within 24 hours of starting the request to a specific endpoint. Otherwise, the files will expire and you will need to restart the job.
			</p>	
    	</div>
	</div>
	
	<p>
		The "Accept-Encoding: gzip" header is optional, but will return a significantly smaller (40X smaller) file with a faster download speed. You	 will need to uncompress the file after downloa	ding 	if you supply this header. When downloading multiple files, you can further speed up the process by downloading multiple files concurrently.	
	</p>	
	<p>	
		The response will be the requested data as FHIR resources in NDJSON format. Each file related to a different resource type will appear separately and labeled as to which resource type it 	contains. Examples of data from each Resource Type are available in the guide to working with BCDA data.
	</p>
