<p>
	To obtain all the available data (up to 7 years) for all of your beneficiaries, you can make a request to either the /Patient or /Group endpoint. You may want to do this as a first call, as a way to check for BCDA files against CCLF, or to create a database.
</p>
<p>
	BCDA data will be updated weekly, so you will be able to make requests and expect to retrieve new data on a weekly basis.
</p>

<h2>List of Requests</h2>
<p>You can make a few different unfiltered requests for data:</p>
<ol>
	<li>Request all three Resource Types at once</li>
	<li>Request any two Resource Types</li>
	<li>Request a single Resource Type</li>
</ol>

<h3>Steps</h3>
<p>
	Each request will follow the same four step process:
</p>
<ol>
	<li>Obtain an access token</li>
	<li>Start a job to acquire data</li>
	<li>Check the job status</li>
	<li>Download the data</li>
</ol>








<h2>Request all three resource types</h2>

<p>
	<b>Note: We have provided a few examples below. But, we are retrieving resource types only from the /Patient endpoint for only certain resource types. The request and cURL statements can be altered to retrieve any combination of resource types and resource types from the /Group endpoint as needed.</b>
</p>





<h3>Step 1: Obtain an Access Token</h3>
	<p>
		See <a href="https://bcda.cms.gov/production/technical-user-guide/#authentication-and-authorization">Authentication and Authorization</a> above.
	</p>






<h3>Step 2: Start a job to acquire data</h3>

<h4>Requests to start a job</h4>
<code>
	<ol>
		<li>GET /api/v1/Patient/$export</li>
		<li>GET /api/v1/Patient/$export?_type=ExplanationOfBenefit,Patient</li>
		<li>GET /api/v1/Patient/$export?_type=Patient</li>
	</ol>
</code>

<h4>Request Headers</h4>
<code>
	<ul>
		<li>Authorization: Bearer {token}</li>
		<li>Accept: application/fhir+json</li>
		<li>Prefer: respond-async</li>
	</ul>
</code>

<h4>cURL Commands to start a job</h4>
	<code>
			<ol>	
				<li>curl -X GET "<a href="https://api.bcda.cms.gov/api/v1/Patient/$export">https://api.bcda.cms.gov/api/v1/Patient/$export</a>"<br/>-H "accept: application/fhir+json"<br/>-H 	"Prefer: respond-async"<br/>-H "Authorization: Bearer {token}"`</li>			
				<li>curl -X GET "<a href="https://api.bcda.cms.gov/api/v1/Patient/$export?_ty	pe=ExplanationOfBenefit,Patient">https://api.bcda.cms.gov/api/v1/Patient/$export?_type=ExplanationOf	Benefit,Patient	</a>"<br/>-H "accept: application/fhir+json"<br/>-H "Prefer: respond-async"<br/>-H "Authorization: Bearer {token}"`</li>		
				<li>curl -X GET "https://api.bcda.cms.gov/api/v1/Patient/$export?_type=Patient	"</li>	
			</ol>	
		<p>-H "accept: application/fhir+json"<br/>-H "Prefer: respond-async"<br/>-H "Authorization: Bearer {token}"`</p>
	</code>

<h4>Response Example: Successful Request</h4>
	<code>
		<p>202 Accepted</p>
	</code>

<h4>Response Example: Too Many Requests</h4>
	<code>
		<p>429 Too Many Requests</p>
	</code>

<h4>Response Headers</h4>
	<code>
		<p>Content-Location: https://api.bcda.cms.gov/api/v1/jobs/42</p>
	</code>

<h4>Start a Job Explanation</h4>
	<p>
		This operation will start a data export job. We have provided three example requests and three example cURL statements to start a job for A) all three resource types, B) any two resource types (we use EOB and Patient as an example), or C) any single resource type (we use Patient as an example). All of these can be modified to work with the /Group endpoint by replacing /Patient/ with /Group/all/.
	</p>	
	<p>
		For all three resource types, a GET request is made to the /Patient endpoint without the _type query parameter. For one or two resource types, the desired resources are set in the _type query parameter. Noti	ce that, for multiple resource types, they must be separated by commas.
	</p>	
	<p>
		Your access token is required and set as a header. Accept and Prefer headers are also r	equired. The dollar sign ('$') before the word "export" in the URL indicates that the endpoint is an action rather than a resource. The format is defined by the FHIR Bulk Data Export spec.
	</p>	
	<p>
		If the request was successful, a 202 Accepted response code will be returned and the re	sponse will include a Content-Location header. The value of this header indicates the location to check for job status and outcome. In the example header below, the number 42 in the URL represents the ID of the export job.
	</p>
	<p>
		If you're already requesting data from one endpoint and try to request data from that endpoint again while the first request is processing, you'll receive a 429 Too Many Requests error.
	</p>






<h3>Step 3: Check the job status</h3>

<h4>Request to check the job status</h4>
	<code>
		<p>
			GET https://api.bcda.cms.gov/api/v1/jobs/42
		</p>
	</code>

<h4>Request Headers</h4>
	<code>
		<ul>
			<li>accept: application/fhir+json</li>
			<li>Authorization: Bearer {token}</li>
		</ul>
	</code>

<h4>cURL Command to check the job status</h4>
	<code>
		<p>curl -X GET "https://api.bcda.cms.gov/api/v1/jobs/42" \</p>
		<p>-H "accept: application/fhir+json" \</p>
		<p>-H "Authorization: Bearer {token}"</p>
	</code>

<h4>Response Example: Completed Job</h4>
	<code>
		<p>{</p>
		<p>"transactionTime": "2019-12-09T20:44:01.705398Z",</p>
		<p>"request": "https://api.bcda.cms.gov/api/v1/Patient/$export",</p>
		<p>"requiresAccessToken": true,</p>
		<p>"output": [</p>
		<p>{</p>
		<p>"type": "ExplanationOfBenefit",</p>
		<p>"url": "https://api.bcda.cms.gov/data/42/afd22dfa-c239-4063-8882-eb2712f9f638.ndjson"</p>
		<p>},</p>
		<p>{</p>
		<p>"type": "Coverage",</p>
		<p>"url": "https://api.bcda.cms.gov/data/42/f76a0b76-48ed-4033-aad9-d3eec37e7e83.ndjson"</p>
		<p>},</p>
		<p>{</p>
		<p>"type": "Patient",</p>
		<p>"url": "https://api.bcda.cms.gov/data/42/f92dcf16-63a2-448e-a12a-3bf677f966ed.ndjson"</p>
		<p>}</p>
		<p>],</p>
		<p>"error": [],</p>
		<p>"JobID": 42</p>
		<p>}</p>
	</code>

<h4>Response Headers: Incomplete Job</h4>
	<ul>
		<li>X-Progress: In Progress</li>
	</ul>

<h4>Check the Job Status Explanation</h4>
	<p>This operation will check on the status of a job and return its progress if it has not finished. Notice that the GET request is simply the URL found in the Content-Location header. The Content 	Location header is found from the previous step (starting a job) within the response section.</p>	
	<p>Within the response, a 202 Accepted indicates that the job is processing. The response headers	 will include the X-Progress header. The X-Progress header value will include text indicating the 	job's status in BCDA's workflow and an estimated progress percentage. For example, X-Progress: In	 Progress, 80%.</p>	
	<p>The status will change from 202 Accepted to 200 OK when the export job is complete and the data is ready to be downloaded.</p>	
	<p>Claims data can be found at the URLs within the output field. The number 42 in the data file URLs is the same job ID from the Content-Location header URL in the previous step. If some of the 	data cannot be exported due to errors, details of the errors can be found at the URLs in the error field. The errors are provided in an NDJSON file as FHIR OperationOutcome resources.</p>






<h3>Step 4: Download the data</h3>

<h4>Request to download the data</h4>
	<code>
		<p>GET https://api.bcda.cms.gov/data/42/afd22dfa-c239-4063-8882-eb2712f9f638.ndjson</p>
	</code>

<h4>Request Headers</h4>
	<code>
		<ul>
			<li>Authorization: Bearer {token}</li>
			<li>Accept-Encoding: gzip</li>
		</ul>
	</code>

<h4>cURL Command to download the data</h4>
	<code>
		<p>curl https://api.bcda.cms.gov/data/42/afd22dfa-c239-4063-8882-eb2712f9f638.ndjson \</p>
		<p>-H 'Authorization: Bearer {token}'<br/>-H 'Accept-Encoding: gzip'</p>
	</code>

<h4>Response Example</h4>
	<p>
	<ol>
	    <li><b><a href="https://bcda.cms.gov/assets/data/ExplanationOfBenefit.ndjson" target="_blank"> Explanation of Benefit</a></b></li>
	    <li><b><a href="https://bcda.cms.gov/assets/data/Coverage.ndjson" target="_blank"> Patient</a></b></li>
	    <li><b><a href="https://bcda.cms.gov/assets/data/Patient.ndjson" target="_blank"> Coverage</a></b></li>
	  </ol>
	</p>

<h4>Response Headers</h4>
	<code>
		<p>N/A</p>
	</code>

<h4>Downloading the Data Explanation</h4>
	<p>
		This operation will allow you to obtain the exported data. Notice that the request contains the output URL for a job that is complete (200 OK status).
	</p>
	<p>
		<b>Note:: You will need to download the data file within 24 hours of starting the request to a specific endpoint. Otherwise, the files will expire and you will need to restart the job.</b>
	</p>
	<p>	
		The "Accept-Encoding: gzip" header is optional, but will return a significantly smaller (40X smaller) file with a faster download speed. You	 will need to uncompress the file after downloa	ding 	if you supply this header. When downloading multiple files, you can further speed up the process by downloading multiple files concurrently.	
	</p>	
	<p>	
		The response will be the requested data as FHIR resources in NDJSON format. Each file related to a different resource type will appear separately and labeled as to which resource type it 	contains. Examples of data from each Resource Type are available in the guide to working with BCDA data.
	</p>























<h2>Requesting Filtered Data</h2>

<p>
	<b>Note: Before using _since for the first time, we recommend that you run an unfiltered request (without using _since) to all resource types on the /Patient endpoint in order to retrieve all historical data for your ACO's associated beneficiaries. You only need to do this once. On subsequent calls you can begin retrieving incremental claims data for your beneficiaries using _since. Use the transactionTime from your last bulk data request set as the _since date.</b>
</p>
<p>
	You may want to obtain filtered data for all of your beneficiaries or for a subset of your beneficiaries in order to reduce file size and download time. You can make a request using the _since parameter to either the /Patient or /Group endpoints, but be wary that you understand the difference regarding new beneficiaries. You may want to do this as a repeating call or as a way to check for new data.
</p>

<h4>List of Requests</h4>
	<p>
		You can make a few different filtered requests for data:
	</p>
	<ol>
		<li>Request the most recent data for all beneficiaries</li>
		<li>Use _since within the /Patient endpoint</li>
		<li>Request the most recent data for all beneficiaries AND historical data for newly added beneficiaries</li>
		<li>Use _since within the /Group endpoint</li>
	</ol>

<h4>Steps</h4>
	<p>
		Each request will follow the same four step process as an unfiltered request:
	</p>
		<ol>
			<li>Obtain an access token</li>
			<li>Start a job to acquire data</li>
			<li>Check the job status</li>
			<li>Download the data</li>
		</ol>
	<p>
		The only difference appears in the request of Step 2: Start a job to acquire data.
	</p>


<h3>Using the _since parameter</h3>

<h4>Format dates and times by the FHIR standard</h4>
	<p>
	Dates and times submitted in _since must be listed in the FHIR instant format (YYYY-MM-DDThh:mm:sss+zz:zz).
	</p>
		<ul>
			<li>Sample Date: February 20, 2020 12:00 PM EST</li>
			<li>instant Format: YYYY-MM-DDThh:mm:sss+zz:zz</li>
			<li>Formatted Sample: 2020-02-20T12:00:00.000-05:00</li>
		</ul>
	<p>
		For more information consult <a href="https://www.hl7.org/fhir/datatypes.html#instant">FHIR Datatypes page</a>.
	</p>

<h4>Be wary of requesting data from before 02-12-2020</h4>
	<p>
		Due to limitations in the Beneficiary FHIR Data (BFD) Server, data from before 02-12-2020 is marked with the arbitrary <a href="https://www.hl7.org/fhir/search.html#lastUpdated">lastUpdated</a> date of 01-01-2020. If you input dates between 01-01-2020 and 02-11-2020 in the _since parameter, you will receive all historical data for your beneficiaries. Data loads from 02-12-2020 onwards have been marked with accurate dates.
	</p>



<h3>Request the most recent data for all beneficiaries</h3>

<h4>Step 1: Obtain an Access Token</h4>
<p>See <a href="https://bcda.cms.gov/production/technical-user-guide/#authentication-and-authorization">Authentication and Authorization</a> above.</p>

<h4>Step 2: Start a job</h4>

<h4>Request to start a job using the _since parameter with the /Patient endpoint</h4>
	<code>
		<p>GET /api/v1/Patient/$export?_type=Patient&_since=2020-02-13T08:00:00.000-05:00</p>
	</code>

<h4>Request Headers</h4>
	<code>
	<ul>
		<li>Authorization: Bearer {token}</li>
		<li>Accept: application/fhir+json</li>
		<li>Prefer: respond-async</li>
	</ul>
	</code>

<h4>cURL Command using the _since parameter with the /Patient endpoint</h4>
	<code>
		<p>curl -X GET "https://api.bcda.cms.gov/api/v1/Patient/$export?_type=Patient&_since=2020-02-13T08:00:00.000-05:00</p>
		<p>-H 'Authorization: Bearer {token}' \</p>
		<p>-H 'Accept: application/fhir+json' \</p>
		<p>-H 'Prefer: respond-async'</p> 
	</code>

<h4>Response Example</h4>
	<code>
		<p>EMPTY_BODY</p>
	</code>

<h4>Response Headers</h4>
	<code>
		<p>Content-Location: <a href="https://api.bcda.cms.gov/api/v1/jobs/42">https://api.bcda.cms.gov/api/v1/jobs/42</a></p>
	</code>

<h4>Start a Job using _since with /Patient Explanation</h4>
<p>This operation will start a job for data for all beneficiaries since the selected date: February 13, 2020. Notice that we are seeking data from the /Patient endpoint. This request would behave differently if it was made from the /Group endpoint. In the example, we request the Patient resource type. The steps and format would work similarly for other resource types.</p>
<p>You must provide a _since date in the FHIR format. An access token as well as Accept and Prefer headers are required. The dollar sign ($) before the word "export" in the URL indicates that the endpoint is an action rather than a resource. The format is defined by the FHIR Bulk Data Export spec.</p>
<p>If the request was successful, a 202 Accepted response code will be returned and the response will include a Content-Location header. The value of this header indicates the location to check for job status and outcome. In the example header below, the number 48 in the URL represents the ID of the export job.</p>


<h4>Step 3: Check the job status</h4>
<p>See <em>Step 3: Check the job status</em> in the Request Data section above.</p>

<h4>Step 4: Download the data</h4>
<p>See <em>Step 4: Download the data</em> in the Request Data section above.</p>






<h3>Request recent data for current beneficiaries AND all historical data for newly attributed beneficiaries</h3>

<h4>Step 1: Obtain an Access Token</h4>
<p>See <a href="https://bcda.cms.gov/production/technical-user-guide/#authentication-and-authorization">Authentication and Authorization</a> above.</p>



<h4>Step 2: Start a job</h4>

<h4>Request to Start a job using the _since parameter with the /Group endpoint</h4>
	<code>
		<p>GET /api/v1/Group/all/$export?_type=Patient&_since=2020-02-13T08:00:00.000-05:00</p>
	</code>

<h4>Request Headers</h4>
	<code>
		<ul>
			<li>Authorization: Bearer {token}</li>
			<li>Accept: application/fhir+json</li>
			<li>Prefer: respond-asnc</li>
		</ul>
	</code>

<h4>cURL Command using the _since parameter with the /Group endpoint</h4>
	<code>
		<p>curl -X GET "https://api.bcda.cms.gov/api/v1/Group/all/$export?_type=Patient&_since=2020-02-13T08:00:00.000-05:00</p>
		<p>-H 'Authorization: Bearer {token}' \</p>
		<p>-H 'Accept: application/fhir+json' \</p>
		<p>-H 'Prefer: respond-async'</p>
	</code>

<h4>Response Example</h4>
	<code>
		<p>
		EMPTY_BODY
		</p>
	</code>

<h4>Response Headers</h4>
	<code>
		<p>Content-Location: https://api.bcda.cms.gov/api/v1/jobs/42</p>
	</code>


<h4>Start a Job using _since with /Group Explanation</h4>
	<p>
		This operation will start a job for filtered data for existing beneficiaries since 8PM EST on February 13th, 2020 and all data for newly assigned beneficiaries that month. Notice that a GET 	request is made to the /Group endpoint. This request would behave differently if it was made from the /Patient endpoint. In the example, we request the Patient resource type. The steps and form	at 	would work similarly for other resource types.
	</p>	
	<p>
		You must provide the groupID of "all" as well a	s a _since date in the FHIR format. An access token as well as Accept and Prefer headers are required. The dollar sign ($) before the word 	"export" in the URL indicates that the endpoint is	 an action rather than a resource. The format is defined by the FHIR Bulk Data Export spec.
	</p>	
	<p>
		If the request was successful, a 202 Accepted r	esponse code will be returned and the response will include a Content-Location header. The valu	e of this header indicates the location to c	heck 	for job status and outcome. In the example header 	below, the number 48 in the URL represents the ID of the export job.
	</p>	
	<p>
		<b>Note:, Attribution Data: While most claims data is updated on a weekly cadence (and we encourage you to retrieve you	r ACO's claims data weekly), ACO attribution is only updated one time per 	month, so you will only be able to retrieve historical claims data for newly attributed beneficiaries once per month. Additional calls will only yield duplicative data for these newly attributed 
	beneficiaries.</b>
	</p>

<h4>Step 3: Check the job status</h4>
	<p>See <em>Step 3: Check the job status</em> in the Request Data section above.</p>

<h4>Step 4: Download the data</h4>
	<p>See <em>Step 4: Download the data</em> in the Request Data section above.</p>